// Nicholas Johnson (www.nicholasjohnson.com)
// Forward Advance Training (www.forwardadvance.com)
// MIT licence

!function(){"use strict";function e(e){return e.data.tweets}function t(e,t){return["http://cdn.syndication.twimg.com/widgets/timelines/",e,"?&lang=",t||"en","&callback=JSON_CALLBACK","&suppress_response_codes=true&rnd=",Math.random()].join("")}function n(e,t){return e=angular.isArray(e)?e:[e],e.concat(t)}function a(e){var t,n,a,s,r,i={headers:e.headers,tweets:[]};if(e.body)for(t=angular.element(e.body)[0].getElementsByClassName("tweet"),s=0;s<t.length;s++)n=t[s],a={},a.retweet=n.getElementsByClassName("retweet-credit").length>0,a.id=n.getAttribute("data-tweet-id"),r=n.getElementsByClassName("e-entry-title")[0],a.html=r.innerHTML,a.text=r.textContent||r.innerText,r=n.getElementsByClassName("p-author")[0],a.author={url:r.getElementsByClassName("profile")[0].getAttribute("href"),avatar:r.getElementsByClassName("avatar")[0].getAttribute("src"),fullName:r.getElementsByClassName("p-name")[0].innerText,nickName:r.getElementsByClassName("p-nickname")[0].innerText},a.updated=n.getElementsByClassName("dt-updated")[0].innerText,a.permalink=n.getElementsByClassName("permalink")[0].getAttribute("href"),n.getElementsByClassName("inline-media")[0]&&(a.inlineMedia=n.getElementsByClassName("inline-media")[0].innerHtml),i.tweets.push(a);return i}angular.module("ngTweets",[]).service("tweets",["$http",function(s){var r=this;this.get=function(e){return s({url:t(e.widgetId,e.lang),method:"JSONP",transformResponse:n(s.defaults.transformResponse,function(e){return a(e)})})},this.getTweets=function(t){return r.get(t).then(e)}}])}();